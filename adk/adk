#!/bin/bash
set -e

# Resolve script directory to find Dockerfile relative to this script
DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

# Check for Docker
if ! command -v docker &> /dev/null; then
    echo "Error: Docker is not installed or not in PATH."
    exit 1
fi

# Check if image exists
if [[ "$(docker images -q adk-cli 2> /dev/null)" == "" ]]; then
    echo "Building ADK CLI Docker image..."
    docker build -t adk-cli -f "$DIR/cli/Dockerfile" "$DIR"
fi

# Run container
# -v $PWD:/workspace : Mount current dir
# -w /workspace      : Run inside mount
echo "Running ADK CLI..."
docker run --rm -it \
    -v "$(pwd):/workspace" \
    -w "/workspace" \
    adk-cli "$@"
